{
  "version": 3,
  "sources": ["main.ts"],
  "sourcesContent": ["import { App, Editor, ItemView, MarkdownView, Notice, Plugin, PluginSettingTab, Setting, TFile, WorkspaceLeaf, requestUrl } from 'obsidian';\n\ndeclare global {\n  interface Window {\n    jsMind?: any;\n  }\n}\n\nconst VIEW_TYPE_MINDMAP = 'obsidian-jsmind-mindmap-view';\n\ntype HeadingNode = {\n  id: string;\n  level: number;\n  title: string;\n  start: number;\n  end: number;\n  lineStart: number;\n  headingTextEnd: number;\n  parentId: string | null;\n  children: HeadingNode[];\n  style: 'atx' | 'setext';\n};\n\nfunction computeHeadingSections(markdownText: string): HeadingNode[] {\n  const lines = markdownText.split(/\\n/);\n  const headingRegex = /^(#{1,6})\\s+(.*)$/;\n  const headingsTemp: Array<Omit<HeadingNode, 'end' | 'headingTextEnd' | 'children' | 'parentId'> & { raw: string; style: 'atx' | 'setext' }> = [];\n  let offset = 0;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(headingRegex);\n    if (match) {\n      const hashes = match[1];\n      const title = match[2].trim();\n      const start = offset;\n      const headingTextEnd = start + line.length; // end of heading line\n      headingsTemp.push({\n        id: `h_${i}_${start}`,\n        level: hashes.length,\n        title,\n        start,\n        lineStart: i,\n        raw: line,\n        style: 'atx',\n      });\n    } else if (i + 1 < lines.length) {\n      const next = lines[i + 1];\n      if (/^=+\\s*$/.test(next)) {\n        const start = offset;\n        const title = line.trim();\n        const headingTextEnd = start + line.length; // only first line text\n        headingsTemp.push({\n          id: `h_${i}_${start}`,\n          level: 1,\n          title,\n          start,\n          lineStart: i,\n          raw: line + '\\n' + next,\n          style: 'setext',\n        });\n      } else if (/^-+\\s*$/.test(next)) {\n        const start = offset;\n        const title = line.trim();\n        const headingTextEnd = start + line.length;\n        headingsTemp.push({\n          id: `h_${i}_${start}`,\n          level: 2,\n          title,\n          start,\n          lineStart: i,\n          raw: line + '\\n' + next,\n          style: 'setext',\n        });\n      }\n    }\n    offset += line.length + 1; // +1 for split removed newline\n  }\n  const headings: HeadingNode[] = headingsTemp.map((h, idx) => ({\n    id: h.id,\n    level: h.level,\n    title: h.title,\n    start: h.start,\n    end: markdownText.length,\n    lineStart: h.lineStart,\n    headingTextEnd: h.start + (lines[h.lineStart]?.length ?? 0),\n    parentId: null,\n    children: [],\n    style: h.style,\n  }));\n  for (let i = 0; i < headings.length; i++) {\n    for (let j = i + 1; j < headings.length; j++) {\n      if (headings[j].level <= headings[i].level) {\n        headings[i].end = headings[j].start - 1; // up to the char before next heading\n        break;\n      }\n    }\n  }\n  const stack: HeadingNode[] = [];\n  for (const h of headings) {\n    while (stack.length > 0 && stack[stack.length - 1].level >= h.level) {\n      stack.pop();\n    }\n    h.parentId = stack.length ? stack[stack.length - 1].id : null;\n    if (stack.length) {\n      stack[stack.length - 1].children.push(h);\n    }\n    stack.push(h);\n  }\n  return headings;\n}\n\nfunction buildJsMindTreeFromHeadings(headings: HeadingNode[], fileName: string) {\n  const firstH1 = headings.find(h => h.level === 1);\n  let rootId: string;\n  let rootTopic: string;\n  if (firstH1) {\n    rootId = firstH1.id;\n    rootTopic = firstH1.title || fileName;\n  } else {\n    rootId = `virtual_root_${fileName}`;\n    rootTopic = fileName.replace(/\\.md$/i, '');\n  }\n  const byId = new Map<string, any>();\n  const root: any = { id: rootId, topic: rootTopic, children: [] };\n  byId.set(rootId, root);\n  for (const h of headings) {\n    if (firstH1 && h.id === firstH1.id) continue;\n    const node: any = { id: h.id, topic: h.title, children: [] };\n    byId.set(h.id, node);\n  }\n  for (const h of headings) {\n    if (firstH1 && h.id === firstH1.id) continue;\n    const parentKey = h.parentId ?? (firstH1 ? firstH1.id : rootId);\n    const parent = byId.get(parentKey) ?? root;\n    parent.children.push(byId.get(h.id));\n  }\n  return { meta: { name: fileName }, format: 'node_tree', data: root };\n}\n\nclass MindmapView extends ItemView {\n  private plugin: MindmapPlugin;\n  private file: TFile | null = null;\n  private containerElDiv: HTMLDivElement | null = null;\n  private jm: any | null = null;\n  private headingsCache: HeadingNode[] = [];\n  private suppressSync: boolean = false;\n  private lastSyncedNodeId: string | null = null;\n  private editorSyncIntervalId: number | null = null;\n  private suppressEditorSyncUntil: number = 0;\n  private prevViewport: { nodesTransform: string | null; canvasTransform: string | null } | null = null;\n  private allowCenterRoot: boolean = false;\n  private centerRootWrapped: boolean = false;\n  private addButtonEl: HTMLButtonElement | null = null;\n  private addButtonForNodeId: string | null = null;\n  private addButtonRAF: number | null = null;\n  private revealTimeoutId: number | null = null;\n  private lastDblClickAtMs: number = 0;\n  private deleteButtonEl: HTMLButtonElement | null = null;\n  private suppressProgrammaticNodeUpdate: boolean = false;\n  private isSuspended: boolean = false;\n  private pendingDirty: boolean = false;\n  private editingSizerRAF: number | null = null;\n  private editingSizerNodeEl: HTMLElement | null = null;\n  private idToStableKey: Map<string, string> = new Map();\n  private stableKeyToId: Map<string, string> = new Map();\n  private suppressRevealUntilMs: number = 0;\n  private suppressCursorSyncUntilMs2: number = 0; // suppress cursor-driven sync after scroll-driven\n  private suppressScrollSyncUntilMs: number = 0; // suppress scroll-driven sync after cursor-driven\n  private currentSelectionDriver: 'scroll' | 'cursor' | null = null;\n  private driverHoldUntilMs: number = 0;\n  private scrollSyncEl: HTMLElement | null = null;\n  private scrollSyncHandler: ((e: Event) => void) | null = null;\n  private getJsMindEventName(type: any, data: any): string {\n    try {\n      if (typeof type === 'string') return type;\n      if (data && typeof data.evt === 'string') return data.evt;\n    } catch {}\n    return '';\n  }\n  private getEventNodeId(data: any): string {\n    try {\n      if (!data) return '';\n      if (typeof data.node === 'string') return data.node as string;\n      if (data.node && typeof data.node.id === 'string') return data.node.id as string;\n      if (Array.isArray(data.data) && typeof data.data[0] === 'string') return data.data[0] as string;\n      if (typeof data.id === 'string') return data.id as string;\n    } catch {}\n    return '';\n  }\n  private getEventNodeTopic(data: any): string {\n    try {\n      if (!data) return '';\n      if (typeof data.topic === 'string') return data.topic as string;\n      if (data.node && typeof (data.node as any).topic === 'string') return (data.node as any).topic as string;\n      if (Array.isArray(data.data) && typeof data.data[1] === 'string') return data.data[1] as string;\n    } catch {}\n    return '';\n  }\n  private isMindmapEditingActive(): boolean {\n    try {\n      if (!this.containerElDiv) return false;\n      const root = this.containerElDiv.querySelector('.jsmind-inner') || this.containerElDiv;\n      if (!root) return false;\n      return !!(root.querySelector('input, textarea, [contenteditable=\"true\"]'));\n    } catch { return false; }\n  }\n\n  private isViewVisible(): boolean {\n    try {\n      if (!this.containerElDiv) return false;\n      if (!document.body.contains(this.containerElDiv)) return false;\n      const cs = getComputedStyle(this.containerElDiv);\n      if (cs.display === 'none' || cs.visibility === 'hidden') return false;\n      if (this.containerElDiv.offsetWidth === 0 || this.containerElDiv.offsetHeight === 0) return false;\n      const rects = this.containerElDiv.getClientRects();\n      return rects.length > 0;\n    } catch { return true; }\n  }\n\n  private setSuspended(suspend: boolean) {\n    if (this.isSuspended === suspend) return;\n    this.isSuspended = suspend;\n    if (suspend) {\n      this.hideAddButton();\n    } else {\n      // When resuming, refresh if there were changes while hidden\n      if (this.pendingDirty || !this.jm) {\n        this.pendingDirty = false;\n        this.refresh().catch(() => {});\n      } else {\n        try { this.jm && this.jm.resize && this.jm.resize(); } catch {}\n        this.updateAddButtonPosition();\n      }\n    }\n  }\n\n  constructor(leaf: WorkspaceLeaf, plugin: MindmapPlugin) {\n    super(leaf);\n    this.plugin = plugin;\n  }\n\n  getViewType(): string {\n    return VIEW_TYPE_MINDMAP;\n  }\n\n  getDisplayText(): string {\n    return 'Mindmap Preview';\n  }\n\n  async onOpen() {\n    this.contentEl.empty();\n    // Ensure the view takes available height for canvas/SVG rendering\n    this.contentEl.style.display = 'flex';\n    this.contentEl.style.flexDirection = 'column';\n    this.contentEl.style.height = '100%';\n    ;(this.containerEl as HTMLElement).style.height = '100%';\n    // Inject minimal toolbar styles once\n    try {\n      const styleId = 'obsidian-jsmind-toolbar-style';\n      if (!document.getElementById(styleId)) {\n        const st = document.createElement('style');\n        st.id = styleId;\n        st.textContent = `\n          .mm-toolbar { display: flex; align-items: center; gap: 6px; padding: 4px 0; }\n          .mm-toolbar button {\n            appearance: none; border: 1px solid var(--background-modifier-border);\n            background: var(--interactive-normal); color: var(--text-normal);\n            padding: 2px 8px; border-radius: 5px; font-size: 12px; line-height: 1.2; cursor: pointer;\n          }\n          .mm-toolbar button:hover { background: var(--interactive-hover); }\n        `;\n        document.head.appendChild(st);\n      }\n    } catch {}\n    const toolbar = this.contentEl.createDiv({ cls: 'mm-toolbar' });\n    const refreshBtn = toolbar.createEl('button', { text: 'Refresh' });\n    const followBtn = toolbar.createEl('button', { text: 'Follow Scroll' });\n\n    const container = this.contentEl.createDiv();\n    container.id = 'jsmind_container';\n    container.style.width = '100%';\n    container.style.flex = '1 1 auto';\n    container.style.height = '100%';\n    container.style.minHeight = '400px';\n    container.style.position = 'relative';\n    this.containerElDiv = container;\n    refreshBtn.addEventListener('click', () => this.refresh());\n    followBtn.addEventListener('click', () => {\n      // Re-enable scroll-driven follow immediately\n      this.currentSelectionDriver = 'scroll';\n      this.driverHoldUntilMs = Date.now() + 800;\n      this.suppressCursorSyncUntilMs2 = 0;\n      this.suppressScrollSyncUntilMs = 0;\n    });\n\n    try {\n      await this.ensureJsMindLoaded();\n    } catch (e) {\n      new Notice('Failed to load jsMind. Check network/CSP. Retrying with fallback...');\n      // Try fallback once more\n      try {\n        await this.ensureJsMindLoaded(true);\n      } catch (err) {\n        new Notice('jsMind could not be loaded. Mindmap disabled.');\n        return;\n      }\n    }\n    // Default selection driver to scroll on initial open\n    this.currentSelectionDriver = 'scroll';\n    this.driverHoldUntilMs = Date.now() + 800;\n    this.suppressCursorSyncUntilMs2 = 0;\n    this.suppressScrollSyncUntilMs = 0;\n    await this.refresh();\n\n    // Observe size changes for reliable canvas resizing\n    try {\n      const ro = new ResizeObserver(() => {\n        if (this.jm) {\n          try { this.jm.resize && this.jm.resize(); } catch {}\n        }\n        this.updateAddButtonPosition();\n      });\n      if (this.containerElDiv) ro.observe(this.containerElDiv);\n      this.register(() => ro.disconnect());\n    } catch {}\n\n    // Observe visibility to suspend/resume rendering work\n    try {\n      if (this.containerElDiv) {\n        const iv = new IntersectionObserver((entries) => {\n          const ent = entries[0];\n          if (!ent) return;\n          const visible = ent.isIntersecting && ent.intersectionRatio > 0;\n          this.setSuspended(!visible);\n        }, { root: this.containerElDiv.parentElement || undefined });\n        iv.observe(this.containerElDiv);\n        this.register(() => iv.disconnect());\n      }\n      // Also listen to layout changes as a fallback\n      this.registerEvent(this.app.workspace.on('layout-change', () => {\n        const visible = this.isViewVisible();\n        this.setSuspended(!visible);\n      }));\n    } catch {}\n\n    // Attach editor -> mindmap selection sync\n    this.attachEditorSync();\n\n    this.registerEvent(this.app.vault.on('modify', async (file) => {\n      if (this.file && file.path === this.file.path) {\n        if (this.isSuspended || !this.isViewVisible()) {\n          this.pendingDirty = true;\n          return;\n        }\n        await this.softSyncFromDisk();\n      }\n    }));\n\n    // Follow markdown file changes (any leaf switching to a markdown file)\n    this.registerEvent(this.app.workspace.on('file-open', async (file) => {\n      if (!file) return;\n      try {\n        // Only react to markdown files and only if different from current\n        // @ts-ignore\n        const ext = (file as any).extension || (file.name?.split('.').pop() ?? '');\n        if (ext.toLowerCase() === 'md' && file.path !== this.file?.path) {\n          await this.setFile(file);\n          // reattach scroll sync on file switch\n          try { this.attachEditorSync(); } catch {}\n        }\n      } catch {}\n    }));\n\n    // Also follow active leaf change to catch focus changes between panes\n    this.registerEvent(this.app.workspace.on('active-leaf-change', async (leaf) => {\n      try {\n        const mv = leaf?.view as MarkdownView | undefined;\n        if (mv?.file) {\n          // @ts-ignore\n          const ext = (mv.file as any).extension || (mv.file.name?.split('.').pop() ?? '');\n          if (ext.toLowerCase() === 'md' && mv.file.path !== this.file?.path) {\n            await this.setFile(mv.file);\n            // reattach scroll sync on leaf change\n            try { this.attachEditorSync(); } catch {}\n          }\n        }\n      } catch {}\n    }));\n  }\n\n  async setFile(file: TFile) {\n    this.file = file;\n    this.lastSyncedNodeId = null;\n    // Reset driver to scroll on file switch\n    this.currentSelectionDriver = 'scroll';\n    this.driverHoldUntilMs = Date.now() + 800;\n    this.suppressCursorSyncUntilMs2 = 0;\n    this.suppressScrollSyncUntilMs = 0;\n    if (this.containerElDiv) await this.refresh();\n  }\n\n  async onClose() {\n    this.jm = null;\n    this.containerElDiv = null;\n  }\n\n  private async ensureJsMindLoaded(useFallback: boolean = false): Promise<void> {\n    if (window.jsMind) return;\n    const pluginBase = `${this.app.vault.configDir}/plugins/obsidian-mindmap-jsmind`;\n    const localCssVaultPath = `${pluginBase}/vendor/jsmind/style/jsmind.css`;\n    const localJsVaultPath = `${pluginBase}/vendor/jsmind/es6/jsmind.js`;\n    const localCssUrl = this.app.vault.adapter.getResourcePath(localCssVaultPath);\n    const localJsUrl = this.app.vault.adapter.getResourcePath(localJsVaultPath);\n\n    const cssId = 'jsmind-css';\n    if (!document.getElementById(cssId)) {\n      const link = document.createElement('link');\n      link.id = cssId;\n      link.rel = 'stylesheet';\n      link.type = 'text/css';\n      link.href = localCssUrl;\n      document.head.appendChild(link);\n    }\n\n    // Attempt to inline the FULL official jsMind CSS for complete styling (prefer local)\n    const fullCssId = 'jsmind-css-inline-full';\n    if (!document.getElementById(fullCssId)) {\n      const cssSources = [\n        this.app.vault.adapter.getResourcePath(localCssVaultPath),\n      ];\n      for (const cssUrl of cssSources) {\n        try {\n          const res = await fetch(cssUrl);\n          const text = await res.text();\n          if (text && text.length > 1000) {\n            const style = document.createElement('style');\n            style.id = fullCssId;\n            style.textContent = text;\n            document.head.appendChild(style);\n            break;\n          }\n        } catch {}\n      }\n    }\n\n    const tryInject = (url: string) => new Promise<void>((resolve, reject) => {\n      const scriptId = `jsmind-js-${btoa(url).replace(/=/g, '')}`;\n      if (document.getElementById(scriptId)) {\n        resolve();\n        return;\n      }\n      const script = document.createElement('script');\n      script.id = scriptId;\n      script.src = url;\n      script.async = true;\n      script.onload = () => resolve();\n      script.onerror = () => reject(new Error('Failed to load ' + url));\n      document.head.appendChild(script);\n    });\n\n    // Prefer local vendored JS\n    const localSrc = localJsUrl;\n    try {\n      await tryInject(localSrc);\n      if (window.jsMind) return;\n    } catch {}\n\n    // Last-resort: try reading local JS text and eval if inject failed\n    try {\n      const jsRes = await fetch(localJsUrl);\n      const jsText = await jsRes.text();\n      const script = document.createElement('script');\n      script.text = jsText;\n      document.head.appendChild(script);\n      if (window.jsMind) return;\n    } catch {}\n    throw new Error('Unable to load jsMind');\n  }\n\n  private async refresh() {\n    if (!this.file) {\n      const active = this.app.workspace.getActiveFile();\n      if (!active) return;\n      this.file = active;\n    }\n    if (this.isSuspended || !this.isViewVisible()) {\n      this.pendingDirty = true;\n      return;\n    }\n    // Stop and clear floating buttons before rebuilding DOM\n    this.hideAddButton();\n    this.addButtonEl = null;\n    this.deleteButtonEl = null;\n    // Capture viewport (transform) and selection before rebuild\n    const prevSelectedId = (() => {\n      try { return this.jm?.get_selected_node?.()?.id ?? null; } catch { return null; }\n    })();\n    this.prevViewport = this.captureViewport();\n\n    const content = await this.app.vault.read(this.file);\n    this.headingsCache = computeHeadingSections(content);\n    this.rebuildStableKeyIndex();\n    const mind = buildJsMindTreeFromHeadings(this.headingsCache, this.file.name);\n    if (!this.containerElDiv || !window.jsMind) return;\n    this.containerElDiv.empty();\n    this.containerElDiv.id = 'jsmind_container';\n    const options = { container: 'jsmind_container', theme: 'info', editable: true, mode: 'side', view: { engine: 'svg' ,expander_style: 'number', draggable: false }};\n\n    this.jm = new window.jsMind(options);\n    // Wrap center_root so plugin can decide whether to allow auto-centering root\n    this.wrapCenterRootIfNeeded();\n    // By default,\u7981\u6B62\u5C45\u4E2D\u6839\u8282\u70B9\uFF08\u4F8B\u5982\u9996\u6B21 show \u6216 refresh \u65F6\uFF09\n    this.allowCenterRoot = false;\n    this.jm.show(mind);\n    // Restore previous viewport transform and reselect without centering\n    this.restoreViewport(this.prevViewport);\n    if (prevSelectedId) {\n      try {\n        this.suppressSync = true;\n        this.jm.select_node(prevSelectedId);\n      } finally {\n        setTimeout(() => { this.suppressSync = false; }, 0);\n      }\n    }\n    try { this.jm.expand_all && this.jm.expand_all(); } catch {}\n    // Apply persisted collapsed states for current file after expand_all\n    try {\n      const path = this.file?.path ?? '';\n      const collapsedSet = (this.plugin as any).getCollapsedSet?.(path) as Set<string> | undefined;\n      if (collapsedSet && collapsedSet.size > 0) {\n        for (const key of collapsedSet) {\n          const id = this.stableKeyToId.get(key);\n          if (!id) continue;\n          try { this.jm.collapse_node && this.jm.collapse_node(id); } catch {}\n        }\n      }\n    } catch {}\n    try { this.jm.resize && this.jm.resize(); } catch {}\n\n    // Sync: click/select a node -> reveal and select heading in markdown editor\n    try {\n      const attachSelectionSync = () => {\n        if (this.jm && typeof this.jm.add_event_listener === 'function') {\n          this.jm.add_event_listener((type: any, data: any) => {\n            const evt = this.getJsMindEventName(type, data);\n            const nodeIdFromEvent = this.getEventNodeId(data);\n            if (evt === 'select_node' && nodeIdFromEvent) {\n              if (Date.now() < this.suppressRevealUntilMs) return;\n              if (this.isMindmapEditingActive()) return;\n              if (this.suppressSync) return;\n              // Debounce single-click to not block double-click editing in jsMind\n              if (Date.now() - this.lastDblClickAtMs < 350) return;\n              if (this.revealTimeoutId != null) window.clearTimeout(this.revealTimeoutId);\n              const nodeId = nodeIdFromEvent;\n              this.revealTimeoutId = window.setTimeout(() => {\n                this.lastSyncedNodeId = nodeId;\n                this.suppressEditorSyncUntil = Date.now() + 600;\n                this.revealHeadingById(nodeId);\n                this.showAddButton(nodeId);\n                this.revealTimeoutId = null;\n              }, 200);\n            }\n            // Some builds of jsMind emit 'edit' on inline rename; also try 'update_node' as fallback\n            if ((evt === 'edit' || evt === 'update_node' || evt === 'nodechanged' || evt === 'topic_change' || evt === 'textedit') && nodeIdFromEvent) {\n              if (this.suppressProgrammaticNodeUpdate) return;\n              if (!this.isMindmapEditingActive() && evt !== 'update_node') return;\n              const nodeId = nodeIdFromEvent;\n              const newTitle: string = this.getEventNodeTopic(data).toString();\n              this.renameHeadingInFile(nodeId, newTitle).catch(() => {});\n            }\n            if (evt === 'select_clear') {\n              this.hideAddButton();\n            }\n            // Persist collapse / expand state per file using stable key\n            if (nodeIdFromEvent) {\n              const key = this.idToStableKey.get(nodeIdFromEvent);\n              if (key) {\n                if (evt === 'collapse_node' || evt === 'collapse') {\n                  try { (this.plugin as any).markCollapsed?.(this.file?.path ?? '', key); } catch {}\n                }\n                if (evt === 'expand_node' || evt === 'expand') {\n                  try { (this.plugin as any).unmarkCollapsed?.(this.file?.path ?? '', key); } catch {}\n                }\n              }\n            }\n          });\n        }\n        if (this.containerElDiv) {\n          const nodesContainer = this.containerElDiv.querySelector('jmnodes') || this.containerElDiv;\n          const handler = (ev: Event) => {\n            const t = ev.target as HTMLElement;\n            const nodeEl = t && (t.closest ? t.closest('jmnode') : null);\n            const nodeId = nodeEl?.getAttribute('nodeid') || '';\n            if (nodeId) {\n              if (this.isMindmapEditingActive()) return;\n              // Debounce click similarly to not interfere double-click\n              if (this.revealTimeoutId != null) window.clearTimeout(this.revealTimeoutId);\n              this.revealTimeoutId = window.setTimeout(() => {\n                // if a dblclick just happened, skip\n                if (Date.now() - this.lastDblClickAtMs < 350) return;\n                this.lastSyncedNodeId = nodeId;\n                this.suppressEditorSyncUntil = Date.now() + 600;\n                this.revealHeadingById(nodeId);\n                this.showAddButton(nodeId);\n                this.revealTimeoutId = null;\n              }, 200);\n            }\n          };\n          nodesContainer.addEventListener('click', handler);\n          const dblHandler = (_ev: Event) => {\n            this.lastDblClickAtMs = Date.now();\n            if (this.revealTimeoutId != null) {\n              window.clearTimeout(this.revealTimeoutId);\n              this.revealTimeoutId = null;\n            }\n            // Allow jsMind to enter edit mode without stealing focus to editor\n          };\n          nodesContainer.addEventListener('dblclick', dblHandler);\n          this.register(() => nodesContainer && nodesContainer.removeEventListener('click', handler));\n          this.register(() => nodesContainer && nodesContainer.removeEventListener('dblclick', dblHandler));\n        }\n      };\n      attachSelectionSync();\n    } catch {}\n  }\n\n  private async softSyncFromDisk() {\n    if (this.isSuspended || !this.isViewVisible()) {\n      this.pendingDirty = true;\n      return;\n    }\n    if (!this.file || !this.jm) {\n      await this.refresh();\n      return;\n    }\n    try {\n      const content = await this.app.vault.read(this.file);\n      const nextHeadings = computeHeadingSections(content);\n      await this.applyHeadingsDiff(this.headingsCache, nextHeadings);\n      this.headingsCache = nextHeadings;\n    } catch {\n      await this.refresh();\n    }\n  }\n\n  private async applyHeadingsDiff(prev: HeadingNode[], next: HeadingNode[]) {\n    if (!this.jm) return;\n    const prevMap = new Map(prev.map(h => [h.id, h] as const));\n    const nextMap = new Map(next.map(h => [h.id, h] as const));\n\n    // Determine root id used by current jm\n    const firstPrevH1 = prev.find(h => h.level === 1) ?? null;\n    const firstNextH1 = next.find(h => h.level === 1) ?? null;\n    const rootId = firstPrevH1 ? firstPrevH1.id : `virtual_root_${this.file?.name}`;\n\n    const getPrevDepth = (h: HeadingNode): number => {\n      let depth = 0;\n      let cur: HeadingNode | undefined = h;\n      while (cur && cur.parentId) {\n        depth += 1;\n        cur = prevMap.get(cur.parentId);\n      }\n      return depth;\n    };\n    // Remove nodes that no longer exist (deepest first) and only if present in jm\n    const toRemove = prev.filter(h => !nextMap.has(h.id)).sort((a, b) => getPrevDepth(b) - getPrevDepth(a));\n    for (const oldH of toRemove) {\n      try {\n        const exists = this.jm.get_node ? this.jm.get_node(oldH.id) : null;\n        if (exists) this.jm.remove_node(oldH.id);\n      } catch {}\n    }\n\n    const getNextDepth = (h: HeadingNode): number => {\n      let depth = 0;\n      let cur: HeadingNode | undefined = h;\n      while (cur && cur.parentId) {\n        depth += 1;\n        cur = nextMap.get(cur.parentId);\n      }\n      return depth;\n    };\n    const resolveExistingParentId = (h: HeadingNode): string => {\n      // ascend until find an ancestor that exists in jm\n      let ancestorId: string | null = h.parentId ?? (firstNextH1 ? firstNextH1.id : rootId);\n      while (ancestorId) {\n        try {\n          const exists = this.jm.get_node ? this.jm.get_node(ancestorId) : null;\n          if (exists) return ancestorId;\n        } catch {}\n        const ancestor = ancestorId ? nextMap.get(ancestorId) : undefined;\n        if (!ancestor) break;\n        ancestorId = ancestor.parentId ?? (firstNextH1 ? firstNextH1.id : rootId);\n      }\n      return firstNextH1 ? firstNextH1.id : rootId;\n    };\n\n    // Add nodes (parents before children)\n    const toAdd = next.filter(h => !prevMap.has(h.id)).sort((a, b) => getNextDepth(a) - getNextDepth(b));\n    for (const newH of toAdd) {\n      const parentKey = resolveExistingParentId(newH);\n      try { this.jm.add_node(parentKey, newH.id, (newH.title && newH.title.trim()) ? newH.title : '\u65B0\u6807\u9898'); } catch {}\n    }\n\n    // Update titles and reparent existing nodes\n    for (const newH of next) {\n      const existed = prevMap.get(newH.id);\n      if (!existed) continue;\n      if (existed.title !== newH.title) {\n        try { this.jm.update_node(newH.id, (newH.title && newH.title.trim()) ? newH.title : '\u65B0\u6807\u9898'); } catch {}\n      }\n      const oldParent = existed.parentId ?? (firstPrevH1 ? firstPrevH1.id : rootId);\n      const newParentDesired = newH.parentId ?? (firstNextH1 ? firstNextH1.id : rootId);\n      if (oldParent !== newParentDesired) {\n        const parentKey = resolveExistingParentId(newH);\n        try {\n          const exists = this.jm.get_node ? this.jm.get_node(newH.id) : null;\n          if (exists) {\n            this.jm.remove_node(newH.id);\n          }\n          this.jm.add_node(parentKey, newH.id, (newH.title && newH.title.trim()) ? newH.title : '\u65B0\u6807\u9898');\n        } catch {}\n      }\n    }\n\n    // Reselect previously selected node without centering\n    try {\n      const sel = this.jm.get_selected_node?.();\n      const selId = sel?.id;\n      if (selId && nextMap.has(selId)) {\n        this.suppressSync = true;\n        try { this.jm.select_node(selId); } finally { setTimeout(() => { this.suppressSync = false; }, 0); }\n      }\n    } catch {}\n  }\n\n  private wrapCenterRootIfNeeded() {\n    try {\n      if (this.centerRootWrapped || !this.jm?.view) return;\n      const view: any = this.jm.view;\n      const originalCenterRoot = view.center_root?.bind(view);\n      const originalCenterNode = view.center_node?.bind(view);\n      if (!originalCenterRoot || !originalCenterNode) return;\n      const self = this;\n      view.center_root = function (...args: any[]) {\n        if (self.allowCenterRoot) {\n          try { return originalCenterRoot(...args); } catch {}\n        }\n        // otherwise no-op to preserve current viewport\n        return undefined;\n      };\n      view.center_node = function (node: any, ...rest: any[]) {\n        try {\n          const root = self.jm?.get_root?.();\n          const isRoot = root && node && node.id === root.id;\n          if (isRoot && !self.allowCenterRoot) {\n            return undefined;\n          }\n          return originalCenterNode(node, ...rest);\n        } catch {}\n        return undefined;\n      };\n      this.centerRootWrapped = true;\n    } catch {}\n  }\n\n  private captureViewport(): { nodesTransform: string | null; canvasTransform: string | null } | null {\n    try {\n      if (!this.containerElDiv) return null;\n      const nodes = this.containerElDiv.querySelector('jmnodes') as HTMLElement | null;\n      const canvas = this.containerElDiv.querySelector('canvas.jsmind') as HTMLElement | null;\n      const nodesTransform = nodes ? getComputedStyle(nodes).transform : null;\n      const canvasTransform = canvas ? getComputedStyle(canvas).transform : null;\n      return { nodesTransform, canvasTransform };\n    } catch {\n      return null;\n    }\n  }\n\n  private restoreViewport(prev: { nodesTransform: string | null; canvasTransform: string | null } | null) {\n    try {\n      if (!prev || !this.containerElDiv) return;\n      const nodes = this.containerElDiv.querySelector('jmnodes') as HTMLElement | null;\n      const canvas = this.containerElDiv.querySelector('canvas.jsmind') as HTMLElement | null;\n      if (nodes && prev.nodesTransform && prev.nodesTransform !== 'none') {\n        (nodes.style as any).transform = prev.nodesTransform;\n      }\n      if (canvas && prev.canvasTransform && prev.canvasTransform !== 'none') {\n        (canvas.style as any).transform = prev.canvasTransform as string;\n      }\n    } catch {}\n  }\n\n  private rebuildStableKeyIndex() {\n    try {\n      this.idToStableKey.clear();\n      this.stableKeyToId.clear();\n      // Build parent chain and sibling index per heading\n      const byId = new Map(this.headingsCache.map(h => [h.id, h] as const));\n      const childrenByParent = new Map<string | null, HeadingNode[]>();\n      for (const h of this.headingsCache) {\n        const p = h.parentId ?? null;\n        if (!childrenByParent.has(p)) childrenByParent.set(p, []);\n        childrenByParent.get(p)!.push(h);\n      }\n      // ensure siblings order is the original order in headingsCache\n      for (const [p, arr] of childrenByParent) {\n        arr.sort((a, b) => a.start - b.start);\n      }\n      const computeKey = (h: HeadingNode): string => {\n        const chain: number[] = [];\n        let cur: HeadingNode | null = h;\n        while (cur) {\n          const parent = cur.parentId ? byId.get(cur.parentId) ?? null : null;\n          const siblings = childrenByParent.get(cur.parentId ?? null) ?? [];\n          const idx = Math.max(0, siblings.findIndex(x => x.id === cur!.id));\n          chain.push(idx);\n        \tcur = parent;\n        }\n        chain.reverse();\n        return chain.join('.') || '0';\n      };\n      for (const h of this.headingsCache) {\n        const key = computeKey(h);\n        this.idToStableKey.set(h.id, key);\n        this.stableKeyToId.set(key, h.id);\n      }\n    } catch {}\n  }\n\n  private async revealHeadingById(nodeId: string) {\n    if (!this.file) return;\n    try {\n      const content = await this.app.vault.read(this.file);\n      const headings = computeHeadingSections(content);\n      const target = headings.find(h => h.id === nodeId);\n      if (!target) return;\n      const lines = content.split('\\n');\n      const lineText = lines[target.lineStart] ?? '';\n      let chStart = 0;\n      if (target.style === 'atx') {\n        const m = lineText.match(/^(#{1,6})\\s+/);\n        chStart = m ? m[0].length : 0;\n      } else {\n        chStart = 0;\n      }\n      const chEnd = lineText.length;\n\n      // Prefer active markdown view if it matches the file\n      const activeMd = this.app.workspace.getActiveViewOfType(MarkdownView);\n      const from = { line: target.lineStart, ch: chStart } as any;\n      const to = { line: target.lineStart, ch: chEnd } as any;\n      if (activeMd?.file?.path === this.file.path) {\n        const editor = activeMd.editor;\n        try { this.app.workspace.revealLeaf(activeMd.leaf); } catch {}\n        try { (editor as any).focus?.(); } catch {}\n        try { editor.setSelection(from, to); } catch {}\n        try { (editor as any).scrollIntoView({ from, to }, true); } catch {}\n        return;\n      }\n      // Otherwise, find the leaf that has this file\n      const mdLeaves = this.app.workspace.getLeavesOfType('markdown');\n      for (const leaf of mdLeaves) {\n        const v = leaf.view as any;\n        if (v?.file?.path === this.file.path) {\n          const mdView = v as MarkdownView;\n          const editor = mdView.editor;\n          try { this.app.workspace.setActiveLeaf(leaf, { focus: true }); } catch {}\n          try { this.app.workspace.revealLeaf(leaf); } catch {}\n          try { (editor as any).focus?.(); } catch {}\n          try { editor.setSelection(from, to); } catch {}\n          try { (editor as any).scrollIntoView({ from, to }, true); } catch {}\n          return;\n        }\n      }\n    } catch {}\n  }\n\n  private selectMindmapNodeById(nodeId: string, center: boolean) {\n    if (!this.jm) return;\n    try {\n      const node = this.jm.get_node ? this.jm.get_node(nodeId) : null;\n      this.suppressSync = true;\n      try {\n        if (this.jm.select_node) this.jm.select_node(nodeId);\n        if (center && node) {\n          // Defer centering until selection/layout settles\n          this.allowCenterRoot = true;\n          window.setTimeout(() => {\n            try { this.jm.center_node && this.jm.center_node(node); } catch {}\n            try { this.jm.view && this.jm.view.center_node && this.jm.view.center_node(node); } catch {}\n            try { this.jm.resize && this.jm.resize(); } catch {}\n            // reset permission to avoid unintended future root centering\n            this.allowCenterRoot = false;\n          }, 30);\n        }\n      } finally {\n        setTimeout(() => { this.suppressSync = false; }, 0);\n      }\n    } catch {}\n  }\n\n  private ensureMindmapNodeVisible(nodeId: string) {\n    try {\n      if (!this.jm || !this.containerElDiv) return;\n      const node = this.jm.get_node ? this.jm.get_node(nodeId) : null;\n      if (!node) return;\n      const nodeEl = this.containerElDiv.querySelector(`jmnode[nodeid=\"${nodeId}\"]`) as HTMLElement | null;\n      if (!nodeEl) return;\n      const hostRect = this.containerElDiv.getBoundingClientRect();\n      const rect = nodeEl.getBoundingClientRect();\n      const margin = 8;\n      const fullyOffLeft = rect.right < hostRect.left + margin;\n      const fullyOffRight = rect.left > hostRect.right - margin;\n      const fullyOffTop = rect.bottom < hostRect.top + margin;\n      const fullyOffBottom = rect.top > hostRect.bottom - margin;\n      const fullyOffscreen = fullyOffLeft || fullyOffRight || fullyOffTop || fullyOffBottom;\n\n      // If horizontally clipped but not fully offscreen, gently adjust horizontal scrollbar\n      let nudged = false;\n      const clippedLeft = rect.left < hostRect.left + margin;\n      const clippedRight = rect.right > hostRect.right - margin;\n      if (!fullyOffscreen && (clippedLeft || clippedRight)) {\n        const deltaLeft = clippedLeft ? (hostRect.left + margin - rect.left) : 0;\n        const deltaRight = clippedRight ? (rect.right - (hostRect.right - margin)) : 0;\n        const deltaX = deltaRight - deltaLeft; // positive = scroll right\n        const el = this.containerElDiv as any;\n        if (typeof el.scrollLeft === 'number') {\n          try { el.scrollLeft += deltaX; nudged = true; } catch {}\n        }\n      }\n\n      if (!nudged && fullyOffscreen) {\n        this.allowCenterRoot = true;\n        try { this.jm.center_node && this.jm.center_node(node); } catch {}\n        try { this.jm.view && this.jm.view.center_node && this.jm.view.center_node(node); } catch {}\n        try { this.jm.resize && this.jm.resize(); } catch {}\n        this.allowCenterRoot = false;\n      }\n    } catch {}\n  }\n\n  private attachEditorSync() {\n    const trySync = async () => {\n      if (!this.file) return;\n      if (Date.now() < this.suppressCursorSyncUntilMs2) return;\n      if (Date.now() < this.suppressEditorSyncUntil) return;\n      const activeMd = this.app.workspace.getActiveViewOfType(MarkdownView);\n      const editorFocused = !!(activeMd && this.isMarkdownEditorFocused(activeMd));\n      if (this.currentSelectionDriver === 'scroll' && Date.now() < this.driverHoldUntilMs && !editorFocused) return;\n      if (!activeMd || activeMd.file?.path !== this.file.path) return;\n      const editor = activeMd.editor;\n      const cursor = editor.getCursor();\n      const content = editor.getValue();\n      const headings = computeHeadingSections(content);\n      if (headings.length === 0) return;\n      const currentLine = cursor.line;\n      let current: HeadingNode | null = null;\n      for (let i = 0; i < headings.length; i++) {\n        const h = headings[i];\n        const next = headings[i + 1];\n        const endLine = next ? next.lineStart - 1 : content.split('\\n').length - 1;\n        if (currentLine >= h.lineStart && currentLine <= endLine) {\n          current = h;\n        }\n      }\n      if (current && current.id !== this.lastSyncedNodeId) {\n        this.lastSyncedNodeId = current.id;\n        const center = this.isMarkdownEditorFocused(activeMd);\n        this.suppressRevealUntilMs = Date.now() + 600;\n        this.suppressScrollSyncUntilMs = Date.now() + 400;\n        this.selectMindmapNodeById(current.id, center);\n        // From markdown-driven selection: hide +/\u2212 to avoid accidental ops\n        this.hideAddButton();\n        this.currentSelectionDriver = 'cursor';\n        this.driverHoldUntilMs = Date.now() + 500;\n      }\n    };\n\n    // Editor content change -> sync\n    this.registerEvent(this.app.workspace.on('editor-change', (editor: Editor, mdView?: MarkdownView) => {\n      if (!this.file) return;\n      if (mdView?.file?.path === this.file.path) {\n        trySync();\n      }\n    }));\n\n    // Reposition + button on container scroll (when scrollbars visible)\n    if (this.containerElDiv) {\n      const scrollHandler = () => this.updateAddButtonPosition();\n      this.containerElDiv.addEventListener('scroll', scrollHandler);\n      this.register(() => this.containerElDiv && this.containerElDiv.removeEventListener('scroll', scrollHandler));\n    }\n\n    // Poll cursor movement (covers pure cursor move without change)\n    const id = window.setInterval(() => { trySync(); }, 400);\n    this.editorSyncIntervalId = id as unknown as number;\n    this.registerInterval(id as unknown as number);\n\n    // Scroll-based top heading sync when enabled\n    const attachScrollSync = () => {\n      // Detach previous\n      try {\n        if (this.scrollSyncEl && this.scrollSyncHandler) {\n          this.scrollSyncEl.removeEventListener('scroll', this.scrollSyncHandler);\n        }\n      } catch {}\n      const activeMd = this.app.workspace.getActiveViewOfType(MarkdownView);\n      if (!activeMd) return;\n      const scroller = (activeMd as any).contentEl?.querySelector?.('.cm-scroller');\n      if (!scroller) return;\n      let ticking = false;\n      const onScroll = () => {\n        if (!this.isAutoFollowEnabled()) return;\n        if (!this.file || activeMd.file?.path !== this.file.path) return;\n        if (ticking) return;\n        // When currently in cursor-driven mode, fully disable scroll-driven syncing\n        if (this.currentSelectionDriver === 'cursor') return;\n        ticking = true;\n        const scRect = (scroller as HTMLElement).getBoundingClientRect();\n        const run = () => {\n          try {\n            const editor = activeMd.editor as any;\n            const content = editor.getValue();\n            const headings = computeHeadingSections(content);\n            if (headings.length === 0) { ticking = false; return; }\n            let best: HeadingNode | null = null;\n            const cmAny = editor?.cm;\n            // Prefer CM6 EditorView directly when available\n            if (cmAny) {\n              let posRes: any = null;\n              if (typeof cmAny.posAtCoords === 'function') {\n                posRes = cmAny.posAtCoords({ x: scRect.left + 16, y: scRect.top + 1 });\n              } else if (cmAny.view && typeof cmAny.view.posAtCoords === 'function') {\n                posRes = cmAny.view.posAtCoords({ x: scRect.left + 16, y: scRect.top + 1 });\n              }\n              const pos = typeof posRes === 'number' ? posRes : (posRes && typeof posRes.pos === 'number' ? posRes.pos : null);\n              const doc = cmAny?.state?.doc ?? cmAny?.view?.state?.doc;\n              if (pos != null && doc?.lineAt) {\n                try {\n                  const lineNo = doc.lineAt(pos).number - 1;\n                  for (const h of headings) { if (h.lineStart >= lineNo) { best = h; break; } }\n                } catch {}\n              }\n            }\n            if (!best) {\n              const cm5 = cmAny;\n              if (cm5?.coordsChar) {\n                const p = cm5.coordsChar({ left: scRect.left + 16, top: scRect.top + 1 }, 'window');\n                if (p && typeof p.line === 'number') {\n                  for (const h of headings) { if (h.lineStart >= p.line) { best = h; break; } }\n                }\n              }\n            }\n            // If none found at/under top, do not change selection\n            if (best && best.id !== this.lastSyncedNodeId) {\n              this.lastSyncedNodeId = best.id;\n              this.hideAddButton();\n              const center = false;\n              this.suppressRevealUntilMs = Date.now() + 600;\n              this.selectMindmapNodeById(best.id, center);\n              // Ensure the node is visible; only center if offscreen\n              this.ensureMindmapNodeVisible(best.id);\n              this.currentSelectionDriver = 'scroll';\n              this.driverHoldUntilMs = Date.now() + 700;\n            }\n          } catch {}\n          ticking = false;\n        };\n        if (typeof window.requestAnimationFrame === 'function') {\n          window.requestAnimationFrame(run);\n        } else {\n          setTimeout(run, 16);\n        }\n      };\n      scroller.addEventListener('scroll', onScroll);\n      this.scrollSyncEl = scroller as HTMLElement;\n      this.scrollSyncHandler = onScroll;\n      this.register(() => scroller && scroller.removeEventListener('scroll', onScroll));\n    };\n    attachScrollSync();\n  }\n\n  private showAddButton(nodeId: string) {\n    try {\n      if (!this.jm || !this.containerElDiv) return;\n      if (this.isMindmapEditingActive()) return;\n      const node = this.jm.get_node?.(nodeId);\n      if (!node || node.isroot) {\n        this.hideAddButton();\n        return;\n      }\n      let btn = this.addButtonEl;\n      if (!btn) {\n        btn = document.createElement('button');\n        btn.textContent = '+';\n        btn.title = 'Add child';\n        btn.style.position = 'absolute';\n        btn.style.zIndex = '5';\n        btn.style.width = '22px';\n        btn.style.height = '22px';\n        btn.style.lineHeight = '22px';\n        btn.style.padding = '0';\n        btn.style.textAlign = 'center';\n        btn.style.boxSizing = 'border-box';\n        btn.style.borderRadius = '11px';\n        btn.style.border = '1px solid #90c2ff';\n        btn.style.background = '#e8f2ff';\n        btn.style.color = '#0b3d91';\n        btn.style.cursor = 'pointer';\n        this.containerElDiv.appendChild(btn);\n        this.addButtonEl = btn;\n      }\n      // If element exists but was removed due to refresh, re-append\n      if (this.addButtonEl && this.addButtonEl.parentElement !== this.containerElDiv) {\n        this.containerElDiv.appendChild(this.addButtonEl);\n      }\n      // Always bind to current nodeId (overwrite previous handler)\n      this.addButtonEl!.onclick = (e) => { e.stopPropagation(); this.addChildUnder(nodeId); };\n      // create delete button alongside\n      if (!this.deleteButtonEl) {\n        const del = document.createElement('button');\n        del.textContent = '\u2212';\n        del.title = 'Delete node';\n        del.style.position = 'absolute';\n        del.style.zIndex = '5';\n        del.style.width = '22px';\n        del.style.height = '22px';\n        del.style.lineHeight = '22px';\n        del.style.padding = '0';\n        del.style.textAlign = 'center';\n        del.style.boxSizing = 'border-box';\n        del.style.borderRadius = '11px';\n        del.style.border = '1px solid #ff9aa2';\n        del.style.background = '#ffecef';\n        del.style.color = '#cc0033';\n        del.style.cursor = 'pointer';\n        this.containerElDiv.appendChild(del);\n        this.deleteButtonEl = del;\n      }\n      if (this.deleteButtonEl && this.deleteButtonEl.parentElement !== this.containerElDiv) {\n        this.containerElDiv.appendChild(this.deleteButtonEl);\n      }\n      // Always bind to current nodeId\n      this.deleteButtonEl!.onclick = (e) => { e.stopPropagation(); this.deleteHeadingById(nodeId); };\n      this.addButtonForNodeId = nodeId;\n      this.updateAddButtonPosition();\n      // start RAF loop to follow transforms while visible\n      if (this.addButtonRAF == null) {\n        const tick = () => {\n          this.updateAddButtonPosition();\n          if (this.addButtonEl && this.addButtonEl.style.display !== 'none') {\n            this.addButtonRAF = window.requestAnimationFrame(tick);\n          } else {\n            if (this.addButtonRAF != null) {\n              window.cancelAnimationFrame(this.addButtonRAF);\n              this.addButtonRAF = null;\n            }\n          }\n        };\n        this.addButtonRAF = window.requestAnimationFrame(tick);\n      }\n    } catch {}\n  }\n\n  private hideAddButton() {\n    if (this.addButtonEl) {\n      this.addButtonEl.style.display = 'none';\n      this.addButtonForNodeId = null;\n      if (this.addButtonRAF != null) {\n        try { window.cancelAnimationFrame(this.addButtonRAF); } catch {}\n        this.addButtonRAF = null;\n      }\n    }\n    if (this.deleteButtonEl) {\n      this.deleteButtonEl.style.display = 'none';\n    }\n  }\n\n  private async addChildUnder(nodeId: string) {\n    if (!this.file) return;\n    const content = await this.app.vault.read(this.file);\n    const headings = computeHeadingSections(content);\n    const parent = headings.find(h => h.id === nodeId) ?? null;\n    let levelToInsert = 1;\n    let insertPos = content.length;\n    if (parent) {\n      levelToInsert = Math.min(parent.level + 1, 6);\n      // Always append at the end of the parent's section (after its entire content block)\n      insertPos = Math.min(parent.end + 1, content.length);\n    }\n    const headingPrefix = '#'.repeat(levelToInsert);\n    const needLeadingNewline = insertPos > 0 && content.charAt(insertPos - 1) !== '\\n';\n    // Use placeholder title to satisfy jsMind's non-empty topic requirement\n    const placeholder = '\u65B0\u6807\u9898';\n    const insertText = `${needLeadingNewline ? '\\n' : ''}${headingPrefix} ${placeholder}\\n`;\n    const updated = content.slice(0, insertPos) + insertText + content.slice(insertPos);\n    await this.app.vault.modify(this.file, updated);\n    new Notice('Child heading inserted');\n    // Immediately focus editor to the inserted placeholder title\n    const newHeadingStart = insertPos + (needLeadingNewline ? 1 : 0);\n    const before = updated.slice(0, newHeadingStart);\n    const newLineIndex = (before.match(/\\n/g)?.length ?? 0);\n    const chStart = headingPrefix.length + 1;\n    const chEnd = chStart + placeholder.length;\n    this.focusEditorToRange(newLineIndex, chStart, chEnd);\n    // re-show buttons for current node after document mutation\n    this.showAddButton(nodeId);\n  }\n\n  private focusEditorToRange(line: number, chStart: number, chEnd: number) {\n    try {\n      const mdLeaves = this.app.workspace.getLeavesOfType('markdown');\n      for (const leaf of mdLeaves) {\n        const v = leaf.view as any;\n        if (v?.file?.path === this.file?.path) {\n          const mdView = v as MarkdownView;\n          const editor = mdView.editor;\n          const from = { line, ch: chStart } as any;\n          const to = { line, ch: chEnd } as any;\n          setTimeout(() => {\n            try { this.app.workspace.setActiveLeaf(leaf, { focus: true }); } catch {}\n            try { this.app.workspace.revealLeaf(leaf); } catch {}\n            try { (editor as any).focus?.(); } catch {}\n            try { editor.setSelection(from, to); } catch {}\n            try { (editor as any).scrollIntoView({ from, to }, true); } catch {}\n          }, 0);\n          break;\n        }\n      }\n    } catch {}\n  }\n\n  private updateAddButtonPosition() {\n    try {\n      if (!this.addButtonEl || !this.containerElDiv || !this.addButtonForNodeId) return;\n      const nodeEl = this.containerElDiv.querySelector(`jmnode[nodeid=\"${this.addButtonForNodeId}\"]`) as HTMLElement | null;\n      if (!nodeEl) return;\n      const node = this.jm?.get_node?.(this.addButtonForNodeId);\n      const expanderEl = this.containerElDiv.querySelector(`jmexpander[nodeid=\"${this.addButtonForNodeId}\"]`) as HTMLElement | null;\n      const rect = nodeEl.getBoundingClientRect();\n      const hostRect = this.containerElDiv.getBoundingClientRect();\n      const isLeft = node && (node.direction === (window.jsMind?.direction?.left ?? 'left'));\n      const buttonSize = 22;\n      const gapBase = 8; // base gap from node/expander\n      let xAdd = isLeft ? rect.left - hostRect.left - (buttonSize + gapBase + 6) : rect.right - hostRect.left + gapBase + 6;\n      // If expander exists, place button beyond it to avoid overlap\n      if (expanderEl) {\n        const expRect = expanderEl.getBoundingClientRect();\n        if (!isLeft) {\n          const minLeft = expRect.right - hostRect.left + gapBase;\n          if (xAdd < minLeft) xAdd = minLeft;\n        } else {\n          const maxLeft = expRect.left - hostRect.left - (buttonSize + gapBase);\n          if (xAdd > maxLeft) xAdd = maxLeft;\n        }\n      }\n      const btnH = (this.addButtonEl?.offsetHeight || 22);\n      const centerYRaw = rect.top - hostRect.top + (rect.height - btnH) / 2;\n      const centerY = Math.round(centerYRaw) - 3; // nudge up 1px for visual centering\n      this.addButtonEl.style.left = `${xAdd}px`;\n      this.addButtonEl.style.top = `${centerY}px`;\n      this.addButtonEl.style.transform = '';\n      this.addButtonEl.style.display = 'block';\n      if (this.deleteButtonEl) {\n        const gap = 4;\n        const xDel = isLeft ? xAdd - (buttonSize + gap) : xAdd + (buttonSize + gap);\n        this.deleteButtonEl.style.left = `${xDel}px`;\n        this.deleteButtonEl.style.top = `${centerY}px`;\n        this.deleteButtonEl.style.transform = '';\n        this.deleteButtonEl.style.display = 'block';\n      }\n    } catch {}\n  }\n\n  private async deleteHeadingById(nodeId: string) {\n    if (!this.file) return;\n    try {\n      const content = await this.app.vault.read(this.file);\n      const headings = computeHeadingSections(content);\n      const target = headings.find(h => h.id === nodeId);\n      if (!target) return;\n      const start = target.start;\n      const end = Math.min(target.end + 1, content.length);\n      const updated = content.slice(0, start) + content.slice(end);\n      await this.app.vault.modify(this.file, updated);\n      new Notice('Node deleted');\n      // After deletion, try to show buttons on parent if exists\n      const newHeadings = computeHeadingSections(updated);\n      const parentId = target.parentId;\n      if (parentId && newHeadings.find(h => h.id === parentId)) {\n        this.showAddButton(parentId);\n      } else {\n        this.hideAddButton();\n      }\n    } catch {}\n  }\n\n  private async renameHeadingInFile(nodeId: string, nextTitleRaw: string) {\n    if (!this.file) return;\n    const safeTitle = (nextTitleRaw && nextTitleRaw.trim()) ? nextTitleRaw.trim() : '\u65B0\u6807\u9898';\n    try {\n      const content = await this.app.vault.read(this.file);\n      const lines = content.split('\\n');\n      const headings = computeHeadingSections(content);\n      const target = headings.find(h => h.id === nodeId);\n      if (!target) return;\n      const lineIdx = target.lineStart;\n      if (lineIdx < 0 || lineIdx >= lines.length) return;\n      if (target.style === 'atx') {\n        const original = lines[lineIdx] ?? '';\n        // Preserve leading hashes, whitespace, and any trailing spaces/closing #s\n        const m = original.match(/^(#{1,6})([ \\t]+)(.*?)([ \\t#]*)$/);\n        if (m) {\n          const leading = m[1] + m[2];\n          const trailing = m[4] ?? '';\n          lines[lineIdx] = `${leading}${safeTitle}${trailing}`;\n        } else {\n          // Fallback: rebuild minimally\n          const hashes = '#'.repeat(Math.min(Math.max(target.level, 1), 6));\n          lines[lineIdx] = `${hashes} ${safeTitle}`;\n        }\n      } else {\n        // setext: change only the title line; underline remains\n        lines[lineIdx] = safeTitle;\n      }\n      const updated = lines.join('\\n');\n      this.suppressProgrammaticNodeUpdate = true;\n      await this.app.vault.modify(this.file, updated);\n      // ensure jsMind node shows placeholder if needed\n      if (this.jm && nextTitleRaw.trim().length === 0) {\n        try { this.jm.update_node(nodeId, safeTitle); } catch {}\n      }\n      // release guard shortly after modify finishes\n      window.setTimeout(() => { this.suppressProgrammaticNodeUpdate = false; }, 300);\n    } catch {\n      this.suppressProgrammaticNodeUpdate = false;\n    }\n  }\n\n\n  private isMarkdownEditorFocused(mdView: MarkdownView): boolean {\n    try {\n      const active = document.activeElement as HTMLElement | null;\n      if (!active) return false;\n      const cmEl = (mdView as any).contentEl?.querySelector?.('.cm-editor');\n      if (!cmEl) return false;\n      return !!(active === cmEl || active.closest?.('.cm-editor') === cmEl);\n    } catch {}\n    return false;\n  }\n\n  private isAutoFollowEnabled(): boolean {\n    try {\n      return (this.plugin as any).settings?.autoFollow === true;\n    } catch {}\n    return false;\n  }\n\n\n}\n\nexport default class MindmapPlugin extends Plugin {\n  private collapsedByFile: Record<string, string[]> = {};\n  public settings: { autoFollow: boolean } = { autoFollow: true };\n\n  async onload() {\n    // Minimal logic change (Option B): sanitize class tokens with whitespace\n    // to avoid InvalidCharacterError when other plugins add class names with spaces.\n    try {\n      const g: any = window as any;\n      if (!g.__jsmindMindmapPatchedClassListAdd) {\n        const proto: any = (DOMTokenList as any).prototype;\n        const originalAdd = proto.add;\n        proto.add = function (...tokens: any[]) {\n          const sanitized = tokens.map((token: any) =>\n            typeof token === 'string' ? token.replace(/\\s+/g, '-') : token\n          );\n          return originalAdd.apply(this, sanitized);\n        };\n        g.__jsmindMindmapPatchedClassListAdd = true;\n      }\n    } catch (e) {\n      // noop\n    }\n\n    // Load settings and persisted collapsed map\n    try {\n      const data = (await this.loadData()) as any;\n      if (data && typeof data === 'object') {\n        if (typeof data.autoFollow === 'boolean') this.settings.autoFollow = data.autoFollow;\n      }\n      if (data && typeof data === 'object' && data.collapsedByFile) {\n        const raw = data.collapsedByFile as Record<string, string[]>;\n        const cleaned: Record<string, string[]> = {};\n        for (const [fp, arr] of Object.entries(raw)) {\n          if (Array.isArray(arr)) {\n            const uniq = Array.from(new Set(arr.filter(v => typeof v === 'string' && v.length > 0)));\n            if (uniq.length > 0) cleaned[fp] = uniq;\n          }\n        }\n        this.collapsedByFile = cleaned;\n      }\n    } catch {}\n\n    this.registerView(\n      VIEW_TYPE_MINDMAP,\n      (leaf) => new MindmapView(leaf, this)\n    );\n\n    this.addCommand({\n      id: 'open-jsmind-preview',\n      name: 'Preview current markdown as mindmap',\n      callback: async () => {\n        const file = this.app.workspace.getActiveFile();\n        if (!file) {\n          new Notice('No active file');\n          return;\n        }\n        const leaf = this.app.workspace.getRightLeaf(false);\n        await leaf.setViewState({ type: VIEW_TYPE_MINDMAP, active: true });\n        const view = leaf.view as MindmapView;\n        await view.setFile(file);\n        this.app.workspace.revealLeaf(leaf);\n      },\n    });\n\n    // Resize handling\n    this.registerDomEvent(window, 'resize', () => {\n      const leaves = this.app.workspace.getLeavesOfType(VIEW_TYPE_MINDMAP);\n      for (const leaf of leaves) {\n        const view = leaf.view as MindmapView;\n        (view as any).jm && (view as any).jm.resize && (view as any).jm.resize();\n      }\n    });\n\n    // Settings tab\n    this.addSettingTab(new MindmapSettingTab(this.app, this));\n  }\n\n  onunload() {\n    this.app.workspace.getLeavesOfType(VIEW_TYPE_MINDMAP).forEach(leaf => leaf.detach());\n  }\n\n  getCollapsedSet(filePath: string): Set<string> {\n    const arr = this.collapsedByFile[filePath] || [];\n    return new Set(arr);\n  }\n\n  async markCollapsed(filePath: string, nodeId: string) {\n    const set = this.getCollapsedSet(filePath);\n    set.add(nodeId);\n    if (set.size > 0) {\n      this.collapsedByFile[filePath] = Array.from(set);\n    } else {\n      delete this.collapsedByFile[filePath];\n    }\n    await this.saveData({ collapsedByFile: this.collapsedByFile, autoFollow: this.settings.autoFollow });\n  }\n\n  async unmarkCollapsed(filePath: string, nodeId: string) {\n    const set = this.getCollapsedSet(filePath);\n    set.delete(nodeId);\n    if (set.size > 0) {\n      this.collapsedByFile[filePath] = Array.from(set);\n    } else {\n      delete this.collapsedByFile[filePath];\n    }\n    await this.saveData({ collapsedByFile: this.collapsedByFile, autoFollow: this.settings.autoFollow });\n  }\n}\n\nclass MindmapSettingTab extends PluginSettingTab {\n  plugin: MindmapPlugin;\n  constructor(app: App, plugin: MindmapPlugin) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n  display(): void {\n    const { containerEl } = this;\n    containerEl.empty();\n    containerEl.createEl('h3', { text: 'Mindmap (jsMind) Settings' });\n    new Setting(containerEl)\n      .setName('Auto follow editor scroll')\n      .setDesc('When scrolling markdown, select the top heading in mindmap')\n      .addToggle(t => t\n        .setValue(this.plugin.settings.autoFollow)\n        .onChange(async (v) => {\n          this.plugin.settings.autoFollow = v;\n          await this.plugin.saveData({ collapsedByFile: this.plugin.collapsedByFile, autoFollow: this.plugin.settings.autoFollow });\n        }));\n  }\n}\n\n\n"],
  "mappings": "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",
  "names": []
}
